nelmio_api_doc:
    documentation:
        info:
            title: Trasteros API
            description: API para la gestión de trasteros, contratos, clientes y finanzas
            version: 1.0.0
        servers:
            - url: /api
              description: API Server
        components:
            securitySchemes:
                Bearer:
                    type: http
                    scheme: bearer
                    bearerFormat: JWT
                    description: 'JWT Authorization header usando el esquema Bearer. Ejemplo: "Authorization: Bearer {token}"'
            schemas:
                Error:
                    type: object
                    description: 'Formato genérico de error de la API'
                    properties:
                        error:
                            type: object
                            required:
                                - message
                                - code
                            properties:
                                message:
                                    type: string
                                    description: 'Mensaje descriptivo del error'
                                    example: 'Error description'
                                code:
                                    type: string
                                    description: 'Código único del error para identificación programática'
                                    example: 'ERROR_CODE'
                                details:
                                    type: object
                                    nullable: true
                                    description: 'Detalles adicionales del error (opcional)'
                NotFoundError:
                    type: object
                    description: 'Error cuando un recurso no existe. Código sigue el patrón {ENTIDAD}_NOT_FOUND'
                    properties:
                        error:
                            type: object
                            properties:
                                message:
                                    type: string
                                    example: 'Cliente with id 123 not found'
                                code:
                                    type: string
                                    description: 'Códigos posibles: CLIENTE_NOT_FOUND, USER_NOT_FOUND, TRASTERO_NOT_FOUND, CONTRATO_NOT_FOUND, LOCAL_NOT_FOUND, DIRECCION_NOT_FOUND, GASTO_NOT_FOUND, INGRESO_NOT_FOUND, PRESTAMO_NOT_FOUND'
                                    example: 'CLIENTE_NOT_FOUND'
                ConflictError:
                    type: object
                    description: 'Error cuando existe un conflicto (recurso duplicado). Código sigue el patrón {ENTIDAD}_ALREADY_EXISTS o VALIDATION_ERROR para duplicados de campos'
                    properties:
                        error:
                            type: object
                            properties:
                                message:
                                    type: string
                                    example: 'Email already exists'
                                code:
                                    type: string
                                    description: 'Códigos posibles: USER_ALREADY_EXISTS, TRASTERO_ALREADY_EXISTS, VALIDATION_ERROR (para campos duplicados como email, dniNie)'
                                    example: 'VALIDATION_ERROR'
                ValidationError:
                    type: object
                    description: 'Error de validación de campos. El objeto details contiene los campos inválidos con sus mensajes de error'
                    properties:
                        error:
                            type: object
                            required:
                                - message
                                - code
                                - details
                            properties:
                                message:
                                    type: string
                                    example: 'Validation failed'
                                code:
                                    type: string
                                    example: 'VALIDATION_ERROR'
                                details:
                                    type: object
                                    description: 'Campos inválidos. Claves posibles: dniNie, email, telefono, codigoPostal, coordenadas, superficie, precioMensual, trasteroEstado, importe, gastoCategoria, ingresoCategoria, metodoPago, fianza, contratoDate, referenciaCatastral, capitalSolicitado, totalADevolver, tipoInteres, prestamoEstado'
                                    additionalProperties:
                                        type: array
                                        items:
                                            type: string
                                    example:
                                        dniNie: ['El DNI/NIE no es válido']
                AuthenticationError:
                    type: object
                    description: 'Error de autenticación (credenciales inválidas)'
                    properties:
                        error:
                            type: object
                            properties:
                                message:
                                    type: string
                                    example: 'Invalid credentials'
                                code:
                                    type: string
                                    example: 'INVALID_CREDENTIALS'
                ForbiddenError:
                    type: object
                    description: 'Error de acceso denegado (usuario inactivo o sin permisos)'
                    properties:
                        error:
                            type: object
                            properties:
                                message:
                                    type: string
                                    example: 'User is inactive'
                                code:
                                    type: string
                                    example: 'USER_INACTIVE'
                PaginatedMeta:
                    type: object
                    properties:
                        total:
                            type: integer
                            example: 10
                User:
                    type: object
                    properties:
                        id:
                            type: string
                            format: uuid
                        nombre:
                            type: string
                            example: 'Juan García'
                        email:
                            type: string
                            format: email
                        rol:
                            type: string
                            enum: [admin, gestor, readonly]
                        activo:
                            type: boolean
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Cliente:
                    type: object
                    properties:
                        id:
                            type: integer
                        nombre:
                            type: string
                            example: 'Juan'
                        apellidos:
                            type: string
                            example: 'García López'
                        dniNie:
                            type: string
                            example: '12345678A'
                        email:
                            type: string
                            format: email
                        telefono:
                            type: string
                            example: '+34612345678'
                        activo:
                            type: boolean
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Direccion:
                    type: object
                    properties:
                        id:
                            type: integer
                        tipoVia:
                            type: string
                            example: 'Calle'
                            nullable: true
                        nombreVia:
                            type: string
                            example: 'Gran Vía'
                        numero:
                            type: string
                            example: '123'
                            nullable: true
                        piso:
                            type: string
                            example: '2'
                            nullable: true
                        puerta:
                            type: string
                            example: 'A'
                            nullable: true
                        codigoPostal:
                            type: string
                            example: '28001'
                        ciudad:
                            type: string
                            example: 'Madrid'
                        provincia:
                            type: string
                            example: 'Madrid'
                        pais:
                            type: string
                            example: 'España'
                        latitud:
                            type: number
                            format: float
                            nullable: true
                        longitud:
                            type: number
                            format: float
                            nullable: true
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Local:
                    type: object
                    properties:
                        id:
                            type: integer
                        nombre:
                            type: string
                            example: 'Nave Principal'
                        direccionId:
                            type: integer
                        superficieTotal:
                            type: number
                            format: float
                            example: 500.5
                        numeroTrasteros:
                            type: integer
                            example: 20
                        fechaCompra:
                            type: string
                            format: date
                            nullable: true
                        precioCompra:
                            type: number
                            format: float
                            nullable: true
                        referenciaCatastral:
                            type: string
                            nullable: true
                        valorCatastral:
                            type: number
                            format: float
                            nullable: true
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Trastero:
                    type: object
                    properties:
                        id:
                            type: integer
                        localId:
                            type: integer
                        numero:
                            type: string
                            example: 'A-01'
                        nombre:
                            type: string
                            example: 'Trastero pequeño'
                            nullable: true
                        superficie:
                            type: number
                            format: float
                            example: 5.5
                        precioMensual:
                            type: number
                            format: float
                            example: 50.0
                        estado:
                            type: string
                            enum: [disponible, ocupado, reservado, mantenimiento]
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Contrato:
                    type: object
                    properties:
                        id:
                            type: integer
                        trasteroId:
                            type: integer
                        clienteId:
                            type: integer
                        fechaInicio:
                            type: string
                            format: date
                        fechaFin:
                            type: string
                            format: date
                            nullable: true
                        precioMensual:
                            type: number
                            format: float
                            example: 50.0
                        fianza:
                            type: number
                            format: float
                            example: 100.0
                        fianzaPagada:
                            type: boolean
                        estado:
                            type: string
                            enum: [activo, pendiente, finalizado, cancelado]
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Ingreso:
                    type: object
                    properties:
                        id:
                            type: integer
                        contratoId:
                            type: integer
                        concepto:
                            type: string
                            example: 'Mensualidad Enero 2024'
                        importe:
                            type: number
                            format: float
                            example: 50.0
                        fechaPago:
                            type: string
                            format: date
                        categoria:
                            type: string
                            enum: [alquiler, fianza, otros]
                        metodoPago:
                            type: string
                            enum: [efectivo, transferencia, tarjeta, domiciliacion, bizum]
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Gasto:
                    type: object
                    properties:
                        id:
                            type: integer
                        localId:
                            type: integer
                        concepto:
                            type: string
                            example: 'Factura electricidad'
                        importe:
                            type: number
                            format: float
                            example: 150.0
                        fecha:
                            type: string
                            format: date
                        categoria:
                            type: string
                            enum: [suministros, mantenimiento, seguros, impuestos, comunidad, otros]
                        descripcion:
                            type: string
                            nullable: true
                        metodoPago:
                            type: string
                            enum: [efectivo, transferencia, tarjeta, domiciliacion, bizum]
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                Prestamo:
                    type: object
                    properties:
                        id:
                            type: integer
                        localId:
                            type: integer
                        capitalSolicitado:
                            type: number
                            format: float
                            example: 100000.0
                        totalADevolver:
                            type: number
                            format: float
                            example: 120000.0
                        fechaConcesion:
                            type: string
                            format: date
                        entidadBancaria:
                            type: string
                            example: 'Banco Ejemplo'
                        numeroPrestamo:
                            type: string
                            example: 'PREST-2024-001'
                            nullable: true
                        tipoInteres:
                            type: number
                            format: float
                            example: 3.5
                        estado:
                            type: string
                            enum: [activo, pagado, cancelado]
                        createdAt:
                            type: string
                            format: date-time
                        updatedAt:
                            type: string
                            format: date-time
                DashboardStats:
                    type: object
                    properties:
                        trasteros:
                            type: object
                            properties:
                                total:
                                    type: integer
                                disponibles:
                                    type: integer
                                ocupados:
                                    type: integer
                                tasaOcupacion:
                                    type: number
                                    format: float
                        contratos:
                            type: object
                            properties:
                                activos:
                                    type: integer
                                total:
                                    type: integer
                                proximosAVencer:
                                    type: integer
                                fianzasPendientes:
                                    type: integer
                        entidades:
                            type: object
                            properties:
                                clientes:
                                    type: integer
                                locales:
                                    type: integer
                        financiero:
                            type: object
                            properties:
                                ingresosMes:
                                    type: number
                                    format: float
                                gastosMes:
                                    type: number
                                    format: float
                                balanceMes:
                                    type: number
                                    format: float
                Rentabilidad:
                    type: object
                    properties:
                        localId:
                            type: integer
                        localNombre:
                            type: string
                        ingresosTotales:
                            type: number
                            format: float
                        gastosTotales:
                            type: number
                            format: float
                        beneficioNeto:
                            type: number
                            format: float
                        rentabilidad:
                            type: number
                            format: float
                LoginResponse:
                    type: object
                    properties:
                        token:
                            type: string
                            example: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...'
                        user:
                            $ref: '#/components/schemas/User'
        security:
            - Bearer: []
        tags:
            - name: Auth
              description: Autenticación y gestión de sesión
            - name: Users
              description: Gestión de usuarios del sistema
            - name: Clientes
              description: Gestión de clientes
            - name: Locales
              description: Gestión de locales/naves
            - name: Trasteros
              description: Gestión de trasteros
            - name: Contratos
              description: Gestión de contratos de alquiler
            - name: Ingresos
              description: Gestión de ingresos
            - name: Gastos
              description: Gestión de gastos
            - name: Prestamos
              description: Gestión de préstamos
            - name: Direcciones
              description: Gestión de direcciones
            - name: Dashboard
              description: Estadísticas y reportes
    areas:
        path_patterns:
            - ^/api(?!/doc)
